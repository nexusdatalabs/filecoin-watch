---
layout: "../layouts/Layout.astro"
---

import csvText from "../data/daily_metrics.csv?raw";
import LineChart from "../components/LineChart.astro";

export const latestEntries = (() => {
  const lines = csvText.trim().split(/\r?\n/);
  if (lines.length < 2) return [];
  const headers = lines.shift().split(",");
  const rows = lines.map((line) => line.split(","));
  const dateIdx = headers.indexOf("date");
  const latestRow = rows.reduce((best, cur) => {
    if (!best) return cur;
    // ISO date strings compare lexicographically
    return cur[dateIdx] > best[dateIdx] ? cur : best;
  }, null);
  return headers.map((h, i) => [h, latestRow?.[i] ?? ""]);
})();

export const series = (() => {
  const lines = csvText.trim().split(/\r?\n/);
  if (lines.length < 2) return [];
  const headers = lines.shift().split(",");
  const dateIdx = headers.indexOf("date");
  if (dateIdx === -1) return [];

  const rows = lines.map((line) => line.split(","));
  rows.sort((a, b) => (a[dateIdx] < b[dateIdx] ? -1 : a[dateIdx] > b[dateIdx] ? 1 : 0));
  const last = rows.slice(-560);

  return last.map((cols) => {
    const rec = {};
    headers.forEach((h, i) => {
      rec[h] = i === dateIdx ? cols[i] : Number(cols[i] || 0);
    });
    return rec;
  });
})();

<header class="site-header">
  <a href={import.meta.env.BASE_URL} aria-label="Filecoin Watch home">
    <img
      src={import.meta.env.BASE_URL + 'favicon.svg'}
      alt="Filecoin Watch"
      width="56"
      height="56"
      decoding="async"
      loading="eager"
      fetchpriority="high"
    />
  </a>
  # Filecoin Watch

  <p class="subhead">An operational view into the Filecoin network</p>
  <nav aria-label="Primary">
    <ul class="nav">
      <li><a href="#about">About</a></li>
      <li><a href="clients">Clients</a></li>
      <li><a href="#charts">Charts</a></li>
      <li><a href="#status">Status</a></li>
    </ul>
  </nav>
</header>

## About

Filecoin Watch is a tiny site that creates essential Filecoin reports across entities like Clients, Providers, Onramps, or Allocators using data from the Filecoin Data Portal.

## Metrics

<dl class="metrics">
  {
    latestEntries.map(([key, value]) => (
      <>
        <dt>{key}</dt>
        <dd>{value}</dd>
      </>
    ))
  }
</dl>

## Charts

<div class="charts">
  <LineChart data={series} x="date" y="unique_deal_making_clients" label="Unique deal-making clients" />
  <LineChart data={series} x="date" y="unique_deal_making_providers" label="Unique deal-making providers" />
  <LineChart data={series} x="date" y="clients_with_active_deals" label="Clients with active deals" />
  <LineChart data={series} x="date" y="providers_with_active_deals" label="Providers with active deals" />
  <LineChart data={series} x="date" y="providers_with_power" label="Providers with power" />
  </div>

## Status

Super Alpha. Data wiring and charts coming soon.
